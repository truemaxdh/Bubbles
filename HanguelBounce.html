<html>
  <head>
    <title>HanguelBounce</title>
    <!-- Google Adsense -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- AutoResponse -->
    <ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-7307479428475282"
     data-ad-slot="8718898251"
     data-ad-format="auto"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    
  </head>
  <body>
    <!-- // Bubbles -->
    <canvas id="cnv" width="800" height="600" style="border:1px solid #73AD21;border-radius:10px;">CANVAS NOT SUPPORTED</canvas>
    
  </body>
  <script>
    // Bubbles
    var c = document.getElementById("cnv");
    var ctx = c.getContext("2d");
    
    var colors = ["red", "orange", "yellow", "green", "blue", "indigo", "purple"];
    function _bubble(consonant, cx, cy, r, dx, dy, style) {
      this.consonant = consonant;
      this.cx = cx;
      this.cy = cy;
      this.r = r;
      this.dx = dx;
      this.dy = dy;
      this.style = style;
      this.color = 0;
    }
    
    var bubbles = [];
    var cnt = Math.random() * 10 + 12;
    var cnv_w = ctx.canvas.width;
    var cnv_h = ctx.canvas.height;
    for (var i = 0; i < cnt; i++) {
      bubbles.push( 
        new _bubble(
          "ㄱㄴㄷㄹㅁㅂㅅㅇㅈㅊㅋㅌㅍㅎ"[Math.floor(Math.random() * 14)],
          Math.random() * cnv_w, 
          Math.random() * cnv_h,
          Math.min(cnv_w, cnv_h) / 20 * (1 + Math.random()),
          (Math.random() - 0.5) * Math.min(cnv_w, cnv_h) / 20,
          (Math.random() - 0.5) * Math.min(cnv_w, cnv_h) / 20,
          (Math.random() >= 0.5) ? "fill" : "stroke"
        )
      );
    }
    
    var lastTimeStamp = null;
    function frame(timeStamp) {
      if (!lastTimeStamp) lastTimeStamp = timeStamp;
      if ((timeStamp - lastTimeStamp) > 30) {
        lastTimeStamp = timeStamp;
    
        // clear
        ctx.beginPath();
        ctx.fillStyle="black";
        ctx.rect(0, 0, cnv_w, cnv_h);
        ctx.fill();

        for (var i = 0; i < bubbles.length; i++) {
          var b = bubbles[i];

          // draw
          ctx.beginPath();
          //ctx.globalAlpha = 0.8;
          ctx.shadowBlur = 10;
          ctx.shadowColor = "black";
          ctx.lineWidth = 3;
          //ctx.arc(b.cx, b.cy, b.r, 0, 2 * Math.PI);
          //ctx.stroke();
          //ctx.fillStyle = "red";
          if (b.style == "fill") {
            ctx.fillStyle=colors[b.color];
            ctx.font = (2 * b.r) + "px Comic Sans MS";
            ctx.textAlign = "center";
            ctx.fillText(b.consonant, b.cx, b.cy);
          } else {
            ctx.strokeStyle=colors[b.color];
            ctx.font = (2 * b.r) + "px Comic Sans MS";
            ctx.textAlign = "center";
            ctx.strokeText(b.consonant, b.cx, b.cy);
          }

          // collision
          for (var j = i + 1; j < bubbles.length; j++) {
            var b2 = bubbles[j];
            var nCx1 = b.cx + b.dx;
            var nCy1 = b.cy + b.dy;
            var nCx2 = b2.cx + b2.dx;
            var nCy2 = b2.cy + b2.dy;
            var d_sqr = (nCx2 - nCx1)*(nCx2 - nCx1) + (nCy2 - nCy1)*(nCy2 - nCy1);
            var d_chk = (b.r + b2.r)*(b.r + b2.r); 
            if (d_sqr < d_chk) {
              var tmp = b.dx + 0;
              b.dx = b2.dx;
              b2.dx = tmp;
              tmp = b.dy + 0;
              b.dy = b2.dy;
              b2.dy = tmp;
              if (++b.color >= colors.length) b.color = 0;
              if (++b2.color >= colors.length) b2.color = 0;
              
            }
            if (d_sqr < (d_chk / 4)) {
              if (b.cx < b2.cx)  {b.cx -= b.r; b2.cx += b2.r;} else {b2.cx -= b2.r; b.cx += b.r;}   
            }
          }
          if ((b.cx + b.dx) < 0 || (b.cx + b.dx) >=  cnv_w) b.dx *= -1;
          if ((b.cy + b.dy) < 0 || (b.cy + b.dy) >=  cnv_h) b.dy *= -1;
          b.cx += b.dx;
          b.cy += b.dy;
        }
      }
      requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
  </script>
</html>
