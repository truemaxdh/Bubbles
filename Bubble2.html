<html>
  <head>
    <title>Bubbles</title>
    <!-- Google Adsense -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- AutoResponse -->
    <ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-7307479428475282"
     data-ad-slot="8718898251"
     data-ad-format="auto"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    
  </head>
  <body>
    <!-- // Bubbles -->
    <canvas id="cnv" width="800" height="600" style="border:1px solid #73AD21;border-radius:10px;">CANVAS NOT SUPPORTED</canvas>
    
  </body>
  <script>
    var c = document.getElementById("cnv");
    var ctx = c.getContext("2d");
    var lastTimeStamp = null;
    
    // Bubbles
    function _bubble(cx, cy, r, dx, dy, c, gco, dur) {
      this.cx = cx;
      this.cy = cy;
      this.r = r;
      this.dx = dx;
      this.dy = dy;
      this.color = c;
      this.gco = gco;
      this.duration = dur;
    }
    
    var bubbles = [];
    var cnt = 5;
    var cnv_w = ctx.canvas.width;
    var cnv_h = ctx.canvas.height;
    for (var i = 0; i < cnt; i++) {
      bubbles.push( 
        new _bubble(
          Math.random() * cnv_w, 
          Math.random() * cnv_h,
          Math.random() * Math.min(cnv_w, cnv_h) * 0.5 + Math.min(cnv_w, cnv_h) * 0.5,
          ((Math.random() < 0.5)?-1:1) * (Math.random() * 13 + 2),
          ((Math.random() < 0.5)?-1:1) * (Math.random() * 13 + 2),
          "" + parseInt(Math.random() * 255) + "," + parseInt(Math.random() * 255) + "," + parseInt(Math.random() * 255),
          "saturation",
          100
        )
      );
    }
    
    function frame(timeStamp) {
      if (!lastTimeStamp) lastTimeStamp = timeStamp;
      if ((timeStamp - lastTimeStamp) > 30) {
        lastTimeStamp = timeStamp;
        for (var i = 0; i < bubbles.length; i++) {
          var b = bubbles[i];

          // draw
          //ctx.globalCompositeOperation = (Math.random() < 0.998) ? "saturation" : "source-over";
          ctx.globalCompositeOperation = b.gco;
          if (b.gco == "source-over")
            ctx.globalAlpha = 0.3;
          else
            ctx.globalAlpha = 1;
          
          ctx.beginPath();
          const g = ctx.createRadialGradient(
            b.cx, b.cy, b.r * 0.1, b.cx, b.cy, b.r
          );
          g.addColorStop(0, "rgba(" + b.color + ",1)");
          g.addColorStop(1, "rgba(" + b.color + ",0)");

          ctx.fillStyle = g;
          ctx.arc(b.cx, b.cy, b.r, 0, 2 * Math.PI);
          ctx.fill();

          // bounce
          if ((b.cx + b.dx) < 0 || (b.cx + b.dx) >=  cnv_w) b.dx *= -1;
          if ((b.cy + b.dy) < 0 || (b.cy + b.dy) >=  cnv_h) b.dy *= -1;
          b.cx += b.dx;
          b.cy += b.dy;
          
          if (--b.duration <= 0) {
            //b.gco = (Math.random() < 0.998) ? "saturation" : "source-over";
            b.gco = (Math.random() < 0.5) ? "saturation" : "source-over";
            b.duration = Math.random() * 100 + 50;
          }
        }
      }

      requestAnimationFrame(frame);
    }
    requestAnimationFrame(frame);
  </script>
</html>
